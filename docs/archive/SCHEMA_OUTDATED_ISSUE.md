# üî¥ ISSUE: Igniter Schema Outdated

## Problem
The browser is showing this error when accessing `/admin/webhooks`:
```
TypeError: Cannot read properties of undefined (reading 'list')
    at AdminWebhooksPage
```

## Root Cause
The `src/igniter.schema.ts` file is **severely outdated** and missing recent controllers.

### Current Schema Status
- **Generated on:** 2025-10-01T01:51:32.301Z (4 days ago)
- **Missing controllers:**
  - ‚ùå `webhooks` (added after 2025-10-01)
  - ‚ùå `organizations` (added after 2025-10-01)
  - ‚ùå `projects` (added after 2025-10-01)

- **Existing controllers:**
  - ‚úÖ `auth`
  - ‚úÖ `example`
  - ‚úÖ `instances`
  - ‚úÖ `share`

### How It Works
1. **Server-side (SSR):** Uses `igniter.router.ts` directly (has all controllers)
2. **Client-side (Browser):** Uses `igniter.schema.ts` (outdated, missing controllers)

**File:** `src/igniter.client.ts:31-36`
```typescript
router: () => {
  if (typeof window === 'undefined') {
    return require('./igniter.router').AppRouter  // ‚úÖ Server (has webhooks)
  }

  return require('./igniter.schema').AppRouterSchema  // ‚ùå Browser (no webhooks)
}
```

## Impact
- ‚ùå **Admin Webhooks page crashes** on load (browser side)
- ‚ùå **Organizations endpoints unavailable** in browser
- ‚ùå **Projects endpoints unavailable** in browser
- ‚úÖ Server-side rendering works fine (uses router directly)

## Solutions

### Option 1: Regenerate Schema (RECOMMENDED)
The `igniter.schema.ts` file is auto-generated by `@igniter-js/cli`.

**Problem:** No `generate` script exists in `package.json`

**Workaround:** Build the Next.js app triggers schema regeneration:
```bash
npm run build
```

**Status:** ‚è≥ Build failed due to TypeScript error in register page (already fixed)

### Option 2: Manual Schema Update (TEMPORARY FIX)
Manually add the missing controllers to `src/igniter.schema.ts`:
- webhooks controller with all actions (list, create, get, update, delete, listDeliveries, retryDelivery)
- organizations controller
- projects controller

**Downside:** File will be overwritten on next auto-generation

### Option 3: Use Router on Client (NOT RECOMMENDED)
Modify `igniter.client.ts` to always use router instead of schema.

**Downside:** Larger client bundle size (router is heavier than schema)

## Recommended Action Plan

1. ‚úÖ Fix TypeScript error in register page (DONE)
2. ‚è≥ Run `npm run build` to regenerate schema
3. ‚úÖ Restart dev server
4. ‚úÖ Test `/admin/webhooks` page loads
5. ‚úÖ Test organizations and projects APIs work

## Files Affected

### `src/igniter.router.ts`
```typescript
export const AppRouter = igniter.router({
  controllers: {
    auth: authController,                    // ‚úÖ In schema
    organizations: organizationsController,  // ‚ùå NOT in schema
    projects: projectsController,            // ‚ùå NOT in schema
    webhooks: webhooksController,            // ‚ùå NOT in schema
    example: exampleController,              // ‚úÖ In schema
    instances: instancesController,          // ‚úÖ In schema
    share: shareController,                  // ‚úÖ In schema
  }
})
```

### `src/igniter.schema.ts` (OUTDATED)
```typescript
export const AppRouterSchema = {
  "controllers": {
    "auth": { ... },         // ‚úÖ EXISTS
    "example": { ... },      // ‚úÖ EXISTS
    "instances": { ... },    // ‚úÖ EXISTS
    "share": { ... },        // ‚úÖ EXISTS
    // ‚ùå Missing: "organizations"
    // ‚ùå Missing: "projects"
    // ‚ùå Missing: "webhooks"
  }
}
```

## Why This Happened

The schema file was likely generated before the following features were added:
1. Organizations system
2. Projects system
3. Webhooks system

After adding these features to the router, the schema was never regenerated, causing a **desynchronization** between server-side (router) and client-side (schema) API definitions.

## Prevention

**Add to `package.json`:**
```json
{
  "scripts": {
    "generate": "igniter generate",  // If available
    "postinstall": "npm run generate"  // Auto-regenerate after install
  }
}
```

**OR manually run after adding new controllers:**
```bash
npm run build  # Triggers schema regeneration
```

---

## Status Updates

### ‚úÖ Fixed Issues
1. TypeScript error in [register/page.tsx:57](src/app/(auth)/register/page.tsx#L57) - Changed `response?.data?.data` to just `response`

### ‚è≥ Pending
1. Regenerate `igniter.schema.ts` with all controllers
2. Test webhooks page loads successfully

### üîß Workaround Applied
- None yet (need to regenerate schema)

---

## How to Verify Fix

1. Check schema file includes webhooks:
```bash
grep -i "webhooks" src/igniter.schema.ts
```

2. Navigate to `/admin/webhooks` in browser
3. Open DevTools console - should see NO errors
4. Page should load with "Webhooks Globais" title

---

**Created:** 2025-10-05
**Updated:** 2025-10-05
**Priority:** üî¥ HIGH (blocks admin webhooks functionality)
